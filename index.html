<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>FunaTrace Redirect</title>
  
  <!-- PWA Metadata -->
  <link rel="manifest" href="https://ahmedsharyph.github.io/funatrace/manifest.json">
  <link rel="apple-touch-icon" href="https://ahmedsharyph.github.io/funatrace/ft_logo.png">
  <meta name="theme-color" content="#00bcd4">

  <style>
    #pwa-install-container {
      position: fixed;
      bottom: 20px;
      right: 20px;
      z-index: 9999;
      background: white;
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      display: none;
    }
    #pwa-install-btn {
      background: #00bcd4;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 4px;
      cursor: pointer;
      font-weight: bold;
    }
    #pwa-dismiss-btn {
      background: transparent;
      border: none;
      color: #666;
      margin-left: 10px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <!-- Hidden container for PWA install prompt -->
  <div id="pwa-install-container">
    <p>Install FunaTrace for better experience</p>
    <button id="pwa-install-btn">Install</button>
    <button id="pwa-dismiss-btn">Not Now</button>
  </div>

  <script>
    // Immediately redirect
    window.location.href = "https://www.ahmedsharyph.mv/p/funatrace-v3.html";
    
    // After redirection, this will execute on the destination page
    document.addEventListener('DOMContentLoaded', function() {
      // Check if PWA is already installed
      function isPWAInstalled() {
        return window.matchMedia('(display-mode: standalone)').matches || 
               window.navigator.standalone ||
               document.referrer.includes('android-app://');
      }
      
      // Load the install script dynamically after redirect
      function loadInstallScript() {
        const script = document.createElement('script');
        script.src = "https://ahmedsharyph.github.io/funatrace/install.js";
        script.onload = initializePWAInstall;
        document.body.appendChild(script);
      }
      
      // Initialize PWA install prompt
      function initializePWAInstall() {
        let deferredPrompt;
        const installContainer = document.getElementById('pwa-install-container');
        const installBtn = document.getElementById('pwa-install-btn');
        const dismissBtn = document.getElementById('pwa-dismiss-btn');
        
        // Only show if not already installed
        if (!isPWAInstalled()) {
          window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            installContainer.style.display = 'block';
            
            // Store dismissal in session storage
            dismissBtn.addEventListener('click', () => {
              installContainer.style.display = 'none';
              sessionStorage.setItem('pwaDismissed', 'true');
            });
            
            // Handle install button click
            installBtn.addEventListener('click', async () => {
              if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                if (outcome === 'accepted') {
                  installContainer.innerHTML = '<p>Thank you for installing!</p>';
                  setTimeout(() => {
                    installContainer.style.display = 'none';
                  }, 2000);
                }
                deferredPrompt = null;
              }
            });
          });
        }
      }
      
      // Check if user previously dismissed the prompt
      if (!sessionStorage.getItem('pwaDismissed') && !isPWAInstalled()) {
        loadInstallScript();
      }
    });
  </script>
</body>
</html>
